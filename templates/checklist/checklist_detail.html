<!DOCTYPE html>
<html>
<head>
<script src="http://openlayers.org/api/OpenLayers.js"></script>
<script src="http://openweathermap.org/js/OWM.OpenLayers.1.3.5.js" ></script>
</head>
<body>
{% load url from future %}

{% block content %}

<a href="/checklist/home/">Home page</a><br>

{% if checklist %}

	{% if error_message %}<p><span style="color:red;font-weight:bold">{{ error_message }}</span></p>{% endif %}
	
	<h1><span style="color:green;font-weight:bold">Checklist Detail Table</span></h1>
	<table border="1">
		<tr><th>Field</th><th>Detail</th><td rowspan="11"><div id="map-weather" style="height:600px;width:800px;"></div></td></tr>
		<tr><td>File number</td><td>{{ checklist.fileNum }}</td></tr>
		<tr><td>Title</td><td>{{ checklist.title }}</td></tr>		
		<tr><td>Status</td>
		{% if checklist.status == "N" %}<td><span style="color:yellow">New</span></td>{% endif %}
		{% if checklist.status == "I" %}<td><span style="color:blue">Inprogress</span></td>{% endif %}
		{% if checklist.status == "S" %}<td><span style="color:orange">Submited</span></td>{% endif %}
		{% if checklist.status == "A" %}<td><span style="color:green">Approved</span></td>{% endif %}
		{% if checklist.status == "R" %}<td><span style="color:red">Rejected</span></td>{% endif %}
		</tr>
		<tr><td>Assigner</td><td>{{ checklist.assigner.username }}</td></tr>
		<tr><td>Assignee</td><td>{{ checklist.assignee_names }}</td></tr>		
		<tr><td>Description</td><td>{{ checklist.description }}</td></tr>
		<tr><td>Date Created</td><td>{{ checklist.create_date }}</td></tr>				
		<tr><td>Land District</td><td>{{ checklist.landDistrict }}</td></tr>
		<tr><td>Address</td><td>{{ checklist.address }}</td></tr>
		<tr><td>Comment</td><td>{{ checklist.comment }}</td></td></tr>
	</table>
	
	<script type="text/javascript">
		var mapnik = new OpenLayers.Layer.OSM();
		var city = new OpenLayers.Layer.Vector.OWMWeather("Weather");
		var mapweather = new OpenLayers.Map("map-weather");
		mapweather.addLayers([mapnik, city]);
		
		var coord = '{{ checklist.address }}';
		var a = coord.split(',');
		if(a.length != 2) {
			a[0] = 0;
			a[1] = 0;
		}
		var lonlat = new OpenLayers.LonLat(parseFloat(a[1])*20000000/180, parseFloat(a[0])*11500000/90);
		mapweather.setCenter(lonlat, 6);
	</script>
	
	<h1><span style="color:green;font-weight:bold">Item Selection Table</span></h1>
	<form action="/checklist/{{ checklist.id }}/validate/" method="post">
	{% csrf_token %}

	<table width="100%" border="0">
		<tr><th>Item name</th><th>Status</th></tr>
		{% for item in checklist.item_set.all %}
		<tr>
			<td>{{ item.item }}</td>
			{% if checklist.status != "S" and checklist.status != "A" %}
				<td>
				<input type="radio" name="{{ item.id }}" value="U" {% if item.itemStatus == "U" %}checked="true"{% endif %}/>
					<span style="color:red">Unanswered</span>
				<input type="radio" name="{{ item.id }}" value="Y" {% if item.itemStatus == "Y" %}checked="true"{% endif %}/>
					<span style="color:green">Yes</span>
				<input type="radio" name="{{ item.id }}" value="N" {% if item.itemStatus == "N" %}checked="true"{% endif %}/>
					<span style="color:blue">N/A</span>
<input type="text" name="Comment" value= "{{ item.itemComment }}"/>
				</td>
			{% else %}
				{% if item.itemStatus == "U" %}<td><span style="color:red">Unanswered</span></td>{% endif %}
				{% if item.itemStatus == "Y" %}<td><span style="color:green">Yes</span></td>{% endif %}
				{% if item.itemStatus == "N" %}<td><span style="color:blue">Not Applicable</span></td>{% endif %}
<input type="text" name="Comment" value= "{{ item.itemComment }}"/>
			{% endif %}	
		</tr>
		{% empty %}
			<li>No item in this list.</li>
		{% endfor %}
	</table>

	{% if checklist.status != "S" and checklist.status != "A" %}
		<input type="submit" value="Save and Validate" style="text-align:center;"/>
	{% endif %}

	{% if validate_message %}
		{% if is_validated %}<p><span style="color:green;font-weight:bold">{{ validate_message }}</span></p>
		{% else %}<p><span style="color:red;font-weight:bold">{{ validate_message }}</span></p>
		{% endif %}
	{% endif %}
	</form>

	<form action="/checklist/{{checklist.id}}/" method="post">
	{% csrf_token %}
	{% if checklist.status != "S" and checklist.status != "A" %}
		<input type="submit" value="Reset"/>
	{% endif %}
	</form>
	
	<form action="/checklist/{{checklist.id}}/submit/" method="post">
	{% csrf_token %}
		{% if checklist.status != "S" and checklist.status != "A" %}
			<input type="submit" value="Validate and Submit for Review" />
		{% endif %}
		
		{% if submit_message %}
			{% if is_submited %}<p><span style="color:green;font-weight:bold">{{ submit_message }}</span></p>
			{% else %}<p><span style="color:red;font-weight:bold">{{ submit_message }}</span></p>
			{% endif %}
		{% endif %}
	
	</form>
{% else %}
    <p>Can't find checklist.</p>
{% endif %}


{% endblock %}
</body>
</html>

